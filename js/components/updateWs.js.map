{"version":3,"sources":["../../src/components/updateWs.js"],"names":["C","URI_BASE","URI_SUFFIX","_crPoint","E","k","date","high","parseFloat","h","low","l","open","o","close","c","volume","v","ws","closeWs","connect","pair","onMessage","onOpen","onClose","onSecond","_prevMinute","WebSocket","addEventListener","Date","getMinutes","event","JSON","parse","data","_d","_m","getSeconds","err","console","log","_toPair","replace","toLowerCase","updateWs","startLiveUpdate","stopLiveUpdate"],"mappings":"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","sourcesContent":["const C = {\r\n  URI_BASE: 'wss://stream.binance.com:9443/ws/',\r\n  URI_SUFFIX: '@kline_1m'\r\n}\r\n\r\nconst _crPoint = (E, k) => ({\r\n  date: E,\r\n  high: parseFloat(k.h),\r\n  low: parseFloat(k.l),\r\n  open: parseFloat(k.o),\r\n  close: parseFloat(k.c),\r\n  volume: parseFloat(k.v)\r\n});\r\n\r\nlet ws;\r\n\r\nfunction closeWs(){\r\n  if (ws) { ws.close() }\r\n}\r\n\r\nfunction connect(pair, onMessage, onOpen, onClose, onSecond){\r\n  let _prevMinute;\r\n  ws = new WebSocket(`${C.URI_BASE}${pair}${C.URI_SUFFIX}`)\r\n\r\n  ws.addEventListener('open', function(){\r\n    _prevMinute = (new Date()).getMinutes()\r\n    onOpen();\r\n  })\r\n  ws.addEventListener('message', function(event){\r\n    try {\r\n      const { E, k } = JSON.parse(event.data)\r\n      , _d = new Date(E)\r\n      , _m = _d.getMinutes();\r\n      if (_prevMinute !== _m) {\r\n        _prevMinute = _m\r\n        onMessage(_crPoint(E, k))\r\n        onSecond('')\r\n      } else {\r\n        onSecond(_d.getSeconds())\r\n      }\r\n    } catch(err) {\r\n      console.log(err)\r\n    }\r\n  })\r\n  ws.addEventListener('error', function(err){\r\n    onClose()\r\n  })\r\n  ws.addEventListener('close', function(event){\r\n    onClose()\r\n  })\r\n}\r\n\r\nconst _toPair = pair => (''+pair)\r\n  .replace('/','')\r\n  .toLowerCase();\r\n\r\nconst updateWs = {\r\n  startLiveUpdate: ({ pair, onMessage, onOpen, onClose, onSecond }) => {\r\n    connect(_toPair(pair), onMessage, onOpen, onClose, onSecond)\r\n  },\r\n  stopLiveUpdate: () => {\r\n     try {\r\n       closeWs()\r\n     } catch(err) {\r\n       console.log(err)\r\n     }\r\n  }\r\n}\r\n\r\nexport default updateWs\r\n"],"file":"updateWs.js"}