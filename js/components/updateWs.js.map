{"version":3,"sources":["../../src/components/updateWs.js"],"names":["C","URI_BASE","URI_SUFFIX","_crPoint","E","k","date","high","parseFloat","h","low","l","open","o","close","c","volume","v","ws","closeWs","connect","pair","onMessage","onOpen","onClose","onSecond","_prevMinute","WebSocket","addEventListener","Date","getMinutes","event","JSON","parse","data","_d","_m","getSeconds","err","console","log","_toPair","replace","toLowerCase","updateWs","startLiveUpdate","stopLiveUpdate"],"mappings":";;;;;AAAA,IAAMA,IAAI;AACRC,YAAU,mCADF;AAERC,cAAY;AAFJ,CAAV;;AAKA,IAAMC,WAAW,SAAXA,QAAW,CAACC,CAAD,EAAIC,CAAJ;AAAA,SAAW;AAC1BC,UAAMF,CADoB;AAE1BG,UAAMC,WAAWH,EAAEI,CAAb,CAFoB;AAG1BC,SAAKF,WAAWH,EAAEM,CAAb,CAHqB;AAI1BC,UAAMJ,WAAWH,EAAEQ,CAAb,CAJoB;AAK1BC,WAAON,WAAWH,EAAEU,CAAb,CALmB;AAM1BC,YAAQR,WAAWH,EAAEY,CAAb;AANkB,GAAX;AAAA,CAAjB;;AASA,IAAIC,WAAJ;;AAEA,SAASC,OAAT,GAAkB;AAChB,MAAID,EAAJ,EAAQ;AAAEA,OAAGJ,KAAH;AAAY;AACvB;;AAED,SAASM,OAAT,CAAiBC,IAAjB,EAAuBC,SAAvB,EAAkCC,MAAlC,EAA0CC,OAA1C,EAAmDC,QAAnD,EAA4D;AAC1D,MAAIC,oBAAJ;AACAR,OAAK,IAAIS,SAAJ,MAAiB3B,EAAEC,QAAnB,GAA8BoB,IAA9B,GAAqCrB,EAAEE,UAAvC,CAAL;;AAEAgB,KAAGU,gBAAH,CAAoB,MAApB,EAA4B,YAAU;AACpCF,kBAAe,IAAIG,IAAJ,EAAD,CAAaC,UAAb,EAAd;AACAP;AACD,GAHD;AAIAL,KAAGU,gBAAH,CAAoB,SAApB,EAA+B,UAASG,KAAT,EAAe;AAC5C,QAAI;AAAA,wBACeC,KAAKC,KAAL,CAAWF,MAAMG,IAAjB,CADf;AAAA,UACM9B,CADN,eACMA,CADN;AAAA,UACSC,CADT,eACSA,CADT;AAAA,UAEA8B,EAFA,GAEK,IAAIN,IAAJ,CAASzB,CAAT,CAFL;AAAA,UAGAgC,EAHA,GAGKD,GAAGL,UAAH,EAHL;;AAIF,UAAIJ,gBAAgBU,EAApB,EAAwB;AACtBV,sBAAcU,EAAd;AACAd,kBAAUnB,SAASC,CAAT,EAAYC,CAAZ,CAAV;AACAoB,iBAAS,EAAT;AACD,OAJD,MAIO;AACLA,iBAASU,GAAGE,UAAH,EAAT;AACD;AACF,KAXD,CAWE,OAAMC,GAAN,EAAW;AACXC,cAAQC,GAAR,CAAYF,GAAZ;AACD;AACF,GAfD;AAgBApB,KAAGU,gBAAH,CAAoB,OAApB,EAA6B,UAASU,GAAT,EAAa;AACxCd;AACD,GAFD;AAGAN,KAAGU,gBAAH,CAAoB,OAApB,EAA6B,UAASG,KAAT,EAAe;AAC1CP;AACD,GAFD;AAGD;;AAED,IAAMiB,UAAU,SAAVA,OAAU;AAAA,SAAQ,CAAC,KAAGpB,IAAJ,EACrBqB,OADqB,CACb,GADa,EACT,EADS,EAErBC,WAFqB,EAAR;AAAA,CAAhB;;AAIA,IAAMC,WAAW;AACfC,mBAAiB,+BAAoD;AAAA,QAAjDxB,IAAiD,QAAjDA,IAAiD;AAAA,QAA3CC,SAA2C,QAA3CA,SAA2C;AAAA,QAAhCC,MAAgC,QAAhCA,MAAgC;AAAA,QAAxBC,OAAwB,QAAxBA,OAAwB;AAAA,QAAfC,QAAe,QAAfA,QAAe;;AACnEL,YAAQqB,QAAQpB,IAAR,CAAR,EAAuBC,SAAvB,EAAkCC,MAAlC,EAA0CC,OAA1C,EAAmDC,QAAnD;AACD,GAHc;AAIfqB,kBAAgB,0BAAM;AACnB,QAAI;AACF3B;AACD,KAFD,CAEE,OAAMmB,GAAN,EAAW;AACXC,cAAQC,GAAR,CAAYF,GAAZ;AACD;AACH;AAVc,CAAjB;;kBAaeM,Q","file":"updateWs.js","sourcesContent":["const C = {\r\n  URI_BASE: 'wss://stream.binance.com:9443/ws/',\r\n  URI_SUFFIX: '@kline_1m'\r\n}\r\n\r\nconst _crPoint = (E, k) => ({\r\n  date: E,\r\n  high: parseFloat(k.h),\r\n  low: parseFloat(k.l),\r\n  open: parseFloat(k.o),\r\n  close: parseFloat(k.c),\r\n  volume: parseFloat(k.v)\r\n});\r\n\r\nlet ws;\r\n\r\nfunction closeWs(){\r\n  if (ws) { ws.close() }\r\n}\r\n\r\nfunction connect(pair, onMessage, onOpen, onClose, onSecond){\r\n  let _prevMinute;\r\n  ws = new WebSocket(`${C.URI_BASE}${pair}${C.URI_SUFFIX}`)\r\n\r\n  ws.addEventListener('open', function(){\r\n    _prevMinute = (new Date()).getMinutes()\r\n    onOpen();\r\n  })\r\n  ws.addEventListener('message', function(event){\r\n    try {\r\n      const { E, k } = JSON.parse(event.data)\r\n      , _d = new Date(E)\r\n      , _m = _d.getMinutes();\r\n      if (_prevMinute !== _m) {\r\n        _prevMinute = _m\r\n        onMessage(_crPoint(E, k))\r\n        onSecond('')\r\n      } else {\r\n        onSecond(_d.getSeconds())\r\n      }\r\n    } catch(err) {\r\n      console.log(err)\r\n    }\r\n  })\r\n  ws.addEventListener('error', function(err){\r\n    onClose()\r\n  })\r\n  ws.addEventListener('close', function(event){\r\n    onClose()\r\n  })\r\n}\r\n\r\nconst _toPair = pair => (''+pair)\r\n  .replace('/','')\r\n  .toLowerCase();\r\n\r\nconst updateWs = {\r\n  startLiveUpdate: ({ pair, onMessage, onOpen, onClose, onSecond }) => {\r\n    connect(_toPair(pair), onMessage, onOpen, onClose, onSecond)\r\n  },\r\n  stopLiveUpdate: () => {\r\n     try {\r\n       closeWs()\r\n     } catch(err) {\r\n       console.log(err)\r\n     }\r\n  }\r\n}\r\n\r\nexport default updateWs\r\n"]}